<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dashboard - MalukuInfraZone</title>
<style>
  :root{
    --bg:#f0f2f7;
    --card:#ffffff;
    --navy:#0f3556;
    --accent:#f3b41f;
    --muted:#6b7c8e;
    font-family: "Poppins", Arial, sans-serif;
  }
  body{
    margin:24px;
    background:var(--bg);
    color:#122;
  }
  .grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:22px;
  }
  .bottom-grid{
    grid-column: 1 / -1;
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:22px;
    margin-top:18px;
  }
  .card{
    background:var(--card);
    border:8px solid #e7eaef;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
  }
  .head{
    background:var(--navy);
    color:#fff;
    text-align:center;
    padding:16px 10px;
  }
  .head h3{margin:0;font-size:15px;font-weight:700;}
  .head .meta{color:#d6e4f6;font-size:13px;margin-top:6px;}
  .head .invest{color:var(--accent);font-weight:700;margin-top:4px;}
  .section{padding:12px;border-top:6px solid #e7edf5;background:#fff;}
  .title-bar{background:var(--navy);color:#fff;padding:8px 12px;font-size:13px;font-weight:700;margin:-12px -12px 8px -12px;}
  table{width:100%;border-collapse:collapse;font-size:13px;}
  td{padding:8px 10px;border-bottom:1px solid #edf1f7;}
  .label{color:#24333f;}
  .value{text-align:right;color:var(--muted);}
  @media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}.bottom-grid{grid-template-columns:1fr}}
  @media(max-width:600px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="grid" id="top-grid"></div>
<div class="bottom-grid" id="bottom-grid"></div>

<script>
// Ambil file JSON dari folder /data
async function loadJson(path){
  try{
    const r = await fetch(path);
    if(!r.ok) throw new Error("Gagal memuat " + path);
    return await r.json();
  }catch(e){
    console.error(e);
    return [];
  }
}
function pick(o,keys){for(const k of keys){if(o[k]!=null)return o[k]}return null}
function formatInvest(v){
  if(!v) return "Rp 0";
  const n=Number(v);
  return isNaN(n)?v:"Rp "+n.toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})+" Miliar";
}
function buildCard(title,jumlah,invest,util,status){
  const c=document.createElement("div");c.className="card";
  c.innerHTML=`
    <div class="head">
      <h3>${title}</h3>
      <div class="meta">Jumlah ${jumlah||"-"}</div>
      <div class="invest">${invest||"-"}</div>
    </div>
    <div class="section">
      <div class="title-bar">Utilisasi</div>
      <table>${util.map(r=>`<tr><td class="label">${r[0]}</td><td class="value">${r[1]}</td></tr>`).join("")||"<tr><td>-</td><td>-</td></tr>"}</table>
    </div>
    <div class="section" style="padding-top:8px">
      <div class="title-bar">Status Keberfungsian</div>
      <table>${status.map(r=>`<tr><td class="label">${r[0]}</td><td class="value">${r[1]}</td></tr>`).join("")||"<tr><td>-</td><td>-</td></tr>"}</table>
    </div>`;
  return c;
}
function mapItem(it){
  const title=pick(it,["Sektor","Program","Nama"])||"Sektor";
  const jumlah=pick(it,["Jumlah Unit","Jumlah"])||"-";
  const invest=formatInvest(pick(it,["Nilai Investasi (Miliar)","Nilai Investasi"]));
  const util=[];
  if(it["Kapasitas Terpasang"])util.push(["Kapasitas Terpasang",it["Kapasitas Terpasang"]]);
  if(it["Kapasitas Terpakai"])util.push(["Kapasitas Terpakai",it["Kapasitas Terpakai"]]);
  if(it["Idle Capacity"])util.push(["Idle Capacity",it["Idle Capacity"]]);
  if(it["Luas Penanganan"])util.push(["Luas Penanganan",it["Luas Penanganan"]]);
  if(it["Luas Kawasan"])util.push(["Luas Kawasan",it["Luas Kawasan"]]);
  const status=[
    ["Berfungsi",it["Berfungsi"]?it["Berfungsi"]+" Unit":"-"],
    ["Tidak Berfungsi",it["Tidak Berfungsi"]?it["Tidak Berfungsi"]+" Unit":"-"]
  ];
  return{title,jumlah,invest,util,status};
}
async function render(){
  const reg=await loadJson("data/rekap_reguler.json");
  const ibm=await loadJson("data/rekap_ibm.json");
  const grid=document.getElementById("top-grid");
  const bottom=document.getElementById("bottom-grid");

  // tampilkan 3 atas dari reguler, 2 bawah dari ibm
  reg.slice(0,3).forEach(i=>{
    const d=mapItem(i);
    grid.appendChild(buildCard(d.title,d.jumlah,d.invest,d.util,d.status));
  });
  ibm.slice(0,2).forEach(i=>{
    const d=mapItem(i);
    bottom.appendChild(buildCard(d.title,d.jumlah,d.invest,d.util,d.status));
  });
}
render();
</script>
</body>
</html>
