<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MalukuInfraZone</title>
<link rel="icon" href="images/favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#071016;
  --glass:rgba(10,18,28,0.78);
  --navy:#0f3556;
  --accent:#f3b41f;
  --muted:#9fb0c6;
  --text-light:#f1f5f9;
  --ff-sans:"Poppins",system-ui,Arial;
}

  /* Judul Rekapitulasi: highlight IBM dan Reguler */
.recap-header h2 {
  margin: 0;
  font-family: 'Montserrat';
  font-weight: 900;
  font-size: 22px;
  color: var(--text-light);
  text-align: center;
}

.recap-header h2 span.ibm {
  color: var(--accent); /* kuning */
}

.recap-header h2 span.reguler {
  color: #4eaaff; /* biru terang */
}

/* NAV & BUTTONS */
.btn, #top-nav a.nav-link {
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:10px 16px;border-radius:12px;font-weight:800;text-decoration:none;
  cursor:pointer;transition:transform .12s,box-shadow .12s,background .12s;
  box-shadow:0 8px 20px rgba(2,6,23,0.45);
}
#top-nav a.nav-link {background:transparent;color:var(--text-light);border:1px solid rgba(255,255,255,0.03);}
.hero .btn {background:var(--accent);color:#071016;border:none;}
#top-nav a.nav-link.active {background:var(--navy);color:var(--accent);border:none;box-shadow:0 10px 30px rgba(4,26,54,0.55);transform:translateY(-2px);}
#top-nav a.nav-link:hover, .btn:hover {transform:translateY(-3px);box-shadow:0 12px 28px rgba(2,6,23,0.55);}

/* BASE */
html,body{height:100%;margin:0;font-family:var(--ff-sans);background:var(--bg);color:var(--text-light);padding-top:72px}
a{color:inherit;text-decoration:none}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;z-index:60;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:var(--glass);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03)}
.brand{display:flex;align-items:center;gap:12px}
.brand img{height:40px}
.site-title{font-family:'Montserrat';font-weight:800;font-size:20px}
nav{display:flex;align-items:center;gap:12px}

/* HERO */
.hero{height:85vh;background:url('images/background-maluku.jpg') center/cover no-repeat;display:flex;align-items:center;justify-content:center;position:relative}
.hero::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.52),rgba(0,0,0,0.78));}
.hero-inner{position:relative;z-index:10;text-align:center;padding:20px;max-width:960px}
.hero h1{font-family:'Montserrat';font-weight:900;font-size:44px;margin:0;}
.hero p{color:var(--muted);margin-top:10px;font-size:16px;}
.hero .cta-row{margin-top:18px;display:flex;gap:12px;justify-content:center}

/* SEKTOR */
.section{padding:54px 18px;max-width:1200px;margin:0 auto}
.sector-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px}
.sector-card{background:rgba(255,255,255,0.02);padding:16px;border-radius:10px;text-align:center}
.sector-card img{width:48px;height:48px;object-fit:contain}
.sector-card h3{color:var(--accent);margin:8px 0 4px;font-size:15px;font-weight:700}
.sector-card p{color:var(--muted);font-size:13px;margin:0}

/* DASHBOARD */
.dashboard{background:linear-gradient(180deg,rgba(6,10,14,0.65),rgba(6,10,14,0.45));padding:36px 18px;border-top:2px solid rgba(255,255,255,0.03)}
.container{max-width:1200px;margin:0 auto;display:flex;flex-direction:column;align-items:center}
.recap-header{width:100%;max-width:1120px;background:rgba(255,255,255,0.02);padding:12px 14px;border-radius:8px;margin-bottom:12px;text-align:center}
.recap-header h2{margin:0;font-family:'Montserrat';font-weight:900;font-size:20px;color:var(--text-light)}
.recap-header p{margin:6px 0 0;color:var(--muted);font-size:13px}

/* CARD GRID */
.cards-row{display:flex;justify-content:center;gap:22px;flex-wrap:wrap;margin-bottom:20px;}
.card{background:linear-gradient(180deg,rgba(11,19,30,0.78),rgba(8,12,18,0.7));border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 10px 30px rgba(4,26,54,0.35);overflow:hidden;width:320px;max-width:90%;transition:transform .2s;display:flex;flex-direction:column;}
.card:hover{transform:translateY(-4px)}
/* =====================
   CARD HEAD DESIGN (ELEGANT)
   ===================== */

.card-head {
  background: var(--navy);
  padding: 16px 10px 22px;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

/* Gradient berbeda untuk Reguler dan IBM */
.card[data-type="reguler"] .card-head {
  background: linear-gradient(180deg, #0f3556 0%, #0a2438 100%);
}
.card[data-type="ibm"] .card-head {
  background: linear-gradient(180deg, #153b75 0%, #0c2850 100%);
}

/* Efek garis halus di bawah judul */
.card-head::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 15%;
  right: 15%;
  height: 1px;
  background: rgba(255,255,255,0.08);
}

/* Judul utama (Infrastruktur Sektor / IBM) */
.card-head h4 {
  font-size: 22px;
  font-weight: 900;
  color: var(--accent);
  margin: 0;
  letter-spacing: 0.02em;
  text-transform: uppercase;
}

/* Nama bidang / program */
.card-head .title-line {
  display: block;
  font-size: 17px;
  font-weight: 700;
  color: var(--text-light);
  margin-top: 4px;
  text-transform: capitalize;
}

/* Label kecil */
.card-head .label-small {
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin-top: 6px;
  text-transform: uppercase;
}

/* Angka jumlah (kuning, besar, tebal) */
.card-head .jumlah {
  display: block;
  font-size: 30px;
  font-weight: 900;
  color: var(--accent);
  margin-top: 2px;
  line-height: 1.2;
  text-shadow: 0 0 6px rgba(243,180,31,0.2);
}

/* Label investasi */
.card-head .invest-label {
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin-top: 6px;
  text-transform: uppercase;
}

/* Nilai investasi */
.card-head .invest-value {
  display: block;
  font-size: 16px;
  font-weight: 700;
  color: var(--accent);
  margin-top: 2px;
}

/* Tambahkan sedikit efek hover */
.card:hover .card-head {
  transform: scale(1.01);
  transition: transform 0.15s ease-in-out;
}
  
.body{padding:12px;background:rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px;min-height:220px;justify-content:flex-start;}
.section-title{text-align:center;background:var(--navy);color:#fff;padding:6px 10px;border-radius:8px;font-weight:700;margin:0 auto 6px;width:86%}
.util-row,.status-row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:6px 8px;color:var(--muted);font-size:13px;}
.util-row .k,.status-row .k{flex:1;color:#dfe9f5;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.util-row .v,.status-row .v{flex:0 0 auto;color:var(--muted);white-space:nowrap;margin-left:8px;}
.util-row.empty,.status-row.empty{opacity:0.08}

/* responsive */
@media(max-width:1100px){.card{width:300px}}
@media(max-width:740px){.card{width:100%}.util-row .k,.util-row .v{white-space:normal}.body{min-height:0}}

  .update-info {
  margin-top: 4px;
  font-size: 13px;
  color: var(--muted);
  font-style: italic;
  text-align: center;
}

</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="images/favicon.png" alt="logo">
    <div class="site-title">MalukuInfraZone</div>
  </div>
  <nav id="top-nav">
    <a href="#hero" class="nav-link" id="nav-home">Beranda</a>
    <a href="peta.html" class="nav-link" id="nav-peta">Peta Infrastruktur</a>
    <a href="#dashboard" class="nav-link" id="nav-dashboard">Dashboard</a>
  </nav>
</header>

<section class="hero" id="hero" aria-label="Hero">
  <div class="hero-inner">
    <h1>Platform Digital BPBPK Maluku</h1>
    <p>Transparansi Data — Akses Informasi Infrastruktur Terbangun Balai Penataan Bangunan, Prasarana dan Kawasan Maluku</p>
    <div class="cta-row">
      <a class="btn" href="#dashboard">Dashboard</a>
      <a class="btn" href="peta.html">Peta Infrastruktur</a>
    </div>
  </div>
</section>

<section class="section" aria-labelledby="sectors-title">
  <h2 id="sectors-title" style="text-align:center;font-family:Montserrat;font-weight:800;margin-bottom:12px">Sektor-Sektor di BPBPK Maluku</h2>
  <div class="sector-grid">
    <div class="sector-card"><img src="images/icon-air.png" alt=""><h3>Air Minum</h3><p>Menyediakan infrastruktur air minum layak untuk masyarakat Maluku.</p></div>
    <div class="sector-card"><img src="images/icon-sanitasi.png" alt=""><h3>Sanitasi</h3><p>Pembangunan dan pengelolaan infrastruktur sanitasi yang mendukung kesehatan lingkungan.</p></div>
    <div class="sector-card"><img src="images/icon-bina.png" alt=""><h3>Bina Penataan Bangunan</h3><p>Pengelolaan tata bangunan dan pengawasan kualitas pembangunan gedung.</p></div>
    <div class="sector-card"><img src="images/icon-kawasan.png" alt=""><h3>Pengembangan Kawasan Strategis</h3><p>Pengembangan kawasan strategis untuk mendukung pertumbuhan wilayah Maluku.</p></div>
  </div>
</section>

<section id="dashboard" class="dashboard" aria-labelledby="recap-title">
  <div class="container">
<div class="recap-header">
  <h2 id="recap-title">
    Rekapitulasi Status Keberfungsian Infrastruktur 
    <span class="reguler">Reguler</span> 
    Terbangun Tahun Anggaran 2020–2024
  </h2>
  <div class="update-info">Data: Periode II Bulan September 2025</div>
</div>

    <div id="cards-reg-top" class="cards-row" aria-live="polite"></div>
    <div id="cards-reg-bottom" class="cards-row" aria-live="polite"></div>

    <div style="height:22px"></div>

   <div class="recap-header">
  <h2>
    Rekapitulasi Status Keberfungsian Infrastruktur 
    <span class="ibm">IBM</span> 
    Terbangun Tahun Anggaran 2020–2024
  </h2>
  <div class="update-info">Data: Periode II Bulan September 2025</div>
</div>


    <div id="cards-ibm-top" class="cards-row" aria-live="polite"></div>
    <div id="cards-ibm-bottom" class="cards-row" aria-live="polite"></div>
  </div>
</section>

<footer style="text-align:center;padding:24px;color:var(--muted);background:var(--bg)">
  &copy; 2025 MalukuInfraZone - BPBPK Maluku
</footer>

<script>
/* Utilities */
async function loadJSON(path){
  try{
    const r = await fetch(path, { cache: 'no-store' });
    if(!r.ok) return [];
    return await r.json();
  }catch(e){
    console.error('loadJSON error', e);
    return [];
  }
}
function pick(obj, keys){
  for(const k of keys) {
    if(!obj) continue;
    if(obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== '') return obj[k];
  }
  return null;
}
function formatInvest(v){
  if(v === null || v === undefined || v === '') return 'Rp 0';
  const n = Number(String(v).replace(/[^0-9.-]+/g,''));
  if(!isNaN(n)) return 'Rp ' + n.toLocaleString('id-ID', { minimumFractionDigits:2, maximumFractionDigits:2 }) + ' Miliar';
  return String(v);
}

/* normalize util rows to fixed count */
function normalizeUtilRows(utilRows, targetCount){
  const rows = Array.isArray(utilRows) ? utilRows.slice() : [];
  while(rows.length < targetCount) rows.push(['','']);
  return rows.slice(0, targetCount);
}

/* build card with flex rows */
function buildCardFlex(prefix, name, jumlah, invest, utilRows, statusRows){
  const TARGET_UTIL_ROWS = 3;
  const util = normalizeUtilRows(utilRows, TARGET_UTIL_ROWS);
  const utilHtml = `<div class="body">
    <div class="section-title">Utilisasi</div>
    ${util.map(r=>`<div class="util-row ${(!r[0] && !r[1]) ? 'empty' : ''}"><div class="k">${r[0]||'-'}</div><div class="v">${r[1]||'-'}</div></div>`).join('')}
    <div style="height:10px"></div>
    <div class="section-title">Status Keberfungsian</div>
    ${statusRows.map(r=>`<div class="status-row"><div class="k">${r[0]}</div><div class="v">${r[1]||'-'}</div></div>`).join('')}
    </div>`;
 return `<div class="card" data-type="${prefix.includes('IBM') ? 'ibm' : 'reguler'}" role="article" aria-label="${prefix} ${name}">
    <div class="card-head">
      <h4>${prefix}</h4>
      <span class="title-line">${name}</span>
      <span class="label-small">JUMLAH</span>
      <span class="jumlah">${jumlah}</span>
      <span class="invest-label">NILAI INVESTASI</span>
      <span class="invest-value">${invest}</span>
    </div>
    ${utilHtml}
  </div>`;
}

/* robust mapItem that uses Satuan Kapasitas fallback for luas */
function mapItem(i){
  const name = pick(i, ['Sektor','Program','Nama','Nama Program']) || '-';
  const jumlah = String(pick(i, ['Jumlah Unit','Jumlah','Unit']) ?? '-');
  const invest = formatInvest(pick(i, ['Nilai Investasi (Miliar)','Nilai Investasi','Investasi']));

  let satuanKap = (pick(i, ['Satuan Kapasitas','Satuan']) || '').replace(/\\\//g, '/').trim();
  let satuanLuas = (pick(i, ['Satuan Luas','Satuan Luas Kawasan']) || '').replace(/\\\//g, '/').trim();
  if(!satuanLuas && satuanKap) satuanLuas = satuanKap;

  const util = [];
  const kt = pick(i, ['Kapasitas Terpasang','Kapasitas terpasang']);
  const kp = pick(i, ['Kapasitas Terpakai','Kapasitas terpakai']);
  const idle = pick(i, ['Idle Capacity','Idle']);
  const luasPen = pick(i, ['Luas Penanganan']);
  const luasKaw = pick(i, ['Luas Kawasan','Luas Total Kawasan']);

  if(kt && kt !== '-') util.push(['Kapasitas Terpasang', `${kt}${satuanKap ? ' ' + satuanKap : ''}`]);
  if(kp && kp !== '-') util.push(['Kapasitas Terpakai', `${kp}${satuanKap ? ' ' + satuanKap : ''}`]);
  if(idle && idle !== '-') util.push(['Idle Capacity', `${idle}${satuanKap ? ' ' + satuanKap : ''}`]);
  if(luasPen && luasPen !== '-') util.push(['Luas Penanganan', `${luasPen}${satuanLuas ? ' ' + satuanLuas : ''}`]);
  if(luasKaw && luasKaw !== '-') util.push(['Luas Kawasan', `${luasKaw}${satuanLuas ? ' ' + satuanLuas : ''}`]);

  const berf = pick(i, ['Berfungsi','Berfungsi Unit','Jumlah Berfungsi']);
  const tbf = pick(i, ['Tidak Berfungsi','Tidak Berfungsi Unit','Jumlah Tidak Berfungsi']);
  const status = [['Berfungsi', berf ?? '-'], ['Tidak Berfungsi', tbf ?? '-']];

  return { prefix: 'Infrastruktur', name, jumlah, invest, util, status };
}

/* render helpers */
/* renderRowsFlex sekarang menerima parameter 'type' = 'reguler' | 'ibm' */
function renderRowsFlex(topId, bottomId, data, type){
  const t = document.getElementById(topId), b = document.getElementById(bottomId);
  if(!t || !b) return;
  t.innerHTML = ''; b.innerHTML = '';
  const list = Array.isArray(data) ? data : [];

  // helper buat prefix berdasarkan tipe dan nama
  function prefixFor(name){
    // normalisasi kecil/besar
    const nm = String(name || '').trim();
    if(type === 'ibm') return 'Infrastruktur IBM';
    // reguler: jika PKS atau BPB tetap "Infrastruktur"
    if(type === 'reguler' && (nm.toUpperCase() === 'PKS' || nm.toUpperCase() === 'BPB')) return 'Infrastruktur';
    // default reguler: "Infrastruktur Sektor"
    return 'Infrastruktur Sektor';
  }

  // render top 3
  list.slice(0,3).forEach(it=>{
    const f = mapItem(it);
    const pref = prefixFor(f.name);
    t.insertAdjacentHTML('beforeend', buildCardFlex(pref, f.name, f.jumlah, f.invest, f.util, f.status));
  });

  // render bottom 2
  list.slice(3,5).forEach(it=>{
    const f = mapItem(it);
    const pref = prefixFor(f.name);
    b.insertAdjacentHTML('beforeend', buildCardFlex(pref, f.name, f.jumlah, f.invest, f.util, f.status));
  });
}


/* load & init */
async function loadAndRender(){
  const reg = await loadJSON('data/rekap_reguler.json');
  const ibm = await loadJSON('data/rekap_ibm.json');
renderRowsFlex('cards-reg-top','cards-reg-bottom', Array.isArray(reg)?reg:[], 'reguler');
renderRowsFlex('cards-ibm-top','cards-ibm-bottom', Array.isArray(ibm)?ibm:[], 'ibm');
}

/* nav active (handles peta.html) */
function setActiveNav(){
  document.querySelectorAll('#top-nav a.nav-link').forEach(a=>a.classList.remove('active'));
  const path = window.location.pathname.split('/').pop().toLowerCase();
  if(path === 'peta.html'){
    const p = document.getElementById('nav-peta'); if(p) p.classList.add('active'); return;
  }
  const sections = [{id:'hero',nav:'nav-home'},{id:'dashboard',nav:'nav-dashboard'}];
  const offset = window.scrollY + 90;
  let active = 'nav-home';
  for(const s of sections){ const el = document.getElementById(s.id); if(el && el.offsetTop <= offset) active = s.nav; }
  const activeEl = document.getElementById(active); if(activeEl) activeEl.classList.add('active');
}

/* smooth internal scroll */
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', e=>{
    const target = a.getAttribute('href').slice(1);
    const el = document.getElementById(target);
    if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}); }
  });
});

window.addEventListener('load', ()=>{ loadAndRender(); setActiveNav(); if(!location.hash) window.scrollTo(0,0); });
window.addEventListener('scroll', setActiveNav);
</script>
</body>
</html>
